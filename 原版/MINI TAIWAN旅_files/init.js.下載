$(window).ready(function (e) {
	ROOT.checkURL();
	ROOT.reset();
});

$(window).on("load", function (e) {
	ROOT.init();
});

$(window).resize(function (e) {
	ROOT.resize();
});


//建立類別
var ROOT = function () { };
//建立屬性
ROOT.scrollTop;
ROOT.winW;
ROOT.winH;
ROOT.device = "A";
ROOT.hash = "";
ROOT.hash2 = "";

//建立方法

ROOT.setDevice = function () {
	if (ROOT.winW > 1600) {
		ROOT.device = "pc";
	} else if (ROOT.winW > 1200 && ROOT.winW <= 1600) {
		ROOT.device = "nb";
	} else if (ROOT.winW > 992 && ROOT.winW <= 1200) {
		ROOT.device = "pad";
	} else if (ROOT.winW <= 992) {
		ROOT.device = "m";
	}
}

ROOT.reset = function () {
	//alert("reset");
	ROOT.winW = $(window).width();
	ROOT.winH = $(window).height();
	//$("#loading").fadeIn(0);
	gsap.to($("#loading"), 0, { alpha: 1, ease: Power2.easeOut });
	$(".naviBox").append(naviHtml);
	$(".menuBox").append(menuHtml);
	//$("body").append(bookingHtml);
	//$("#menuClose").trigger("click");

	if (typeof THIS == "function") { THIS.reset() };
	$.each(THIS.pageObj, function (key, value) {
		ROOT.playAni(key, "reset");
	});
}

ROOT.checkURL = function () {

	if ($.parameter("utm_source") != null) {
		$("#frmpost input[name=utm_source]").val($.parameter("utm_source"));
	}
	if ($.parameter("utm_medium") != null) {
		$("#frmpost input[name=utm_medium]").val($.parameter("utm_medium"));
	}
	if ($.parameter("utm_campaign") != null) {
		$("#frmpost input[name=utm_campaign]").val($.parameter("utm_campaign"));
	}
}




ROOT.init = function () {
	ROOT.scrollTop = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop);
	ROOT.resize();
	ROOT.setup();
	FORM.setupForm();
	$(window).scroll(function () {
		ROOT.scroll();
	});
	$('.lazy').Lazy({
		// 設定屬性值
		scrollDirection: 'vertical',
		effect: 'fadeIn',
		visibleOnly: false,
		afterLoad: function (element) {
			//console.log('afterLoad :');
			//console.log(element.attr('src'));
		},
		onError: function (element) {
			//console.log('error :' + element.attr('data-src'));
		},
		onFinishedAll: function (element) {
		}
	});
}


ROOT.scroll = function () {
	ROOT.checkView();
	ROOT.scrollTop = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop);
	/* if (ROOT.scrollTop > ROOT.winH) {
		THIS.pageObj["home"] = false;
		ROOT.playAni("home", "reset");
	} */
	//console.log(ROOT.scrollTop);

	if (ROOT.device == "m") {

	} else {

	}
	if (typeof THIS == "function") { THIS.scroll() };
}

ROOT.enter = function () {

	ROOT.checkView();
	gsap.to($("#loading"), 0.5, { alpha: 0, ease: Power2.easeOut, onComplete: function () { $("#loading").hide(); } });
	if (typeof THIS == "function") { THIS.enter() };
}

ROOT.resize = function () {
	ROOT.winW = $(window).width();
	ROOT.winH = $(window).height();
	//alert("resize:"+ROOT.winW+" : "+ROOT.winH);

	var old = ROOT.device;
	ROOT.setDevice();
	//alert("resize:"+ROOT.winW+" : "+old+" / "+ROOT.device);
	if (old != ROOT.device) {
		if (ROOT.device == "m") {
			//$("#homeVideo").get(0).play();
			ROOT.checkView();
			//ROOT.killSlider();

			ROOT.showNavi();
		} else if (ROOT.device != "m") {

		}
		if (typeof THIS == "function") { THIS.resize() };
	}
	ROOT.hideMenu();

}

ROOT.setup = function () {
	//alert("setup");

	$(".toggleBtn").off("click");
	$(".toggleBtn").click(function () {
		ROOT.toggleMenu();
		//toggleNavi();
	});

	$("nav .logo").off("click");
	$("nav .logo").click(function (e) {
		window.open("https://www.mini.com.tw/zh_TW/home.html", "_blank");
		ROOT.send2GA("button", "logo");
	});

	/* $(".blackBtn, .borderBtn, .blueBtn").off("mouseover").off("mouseout").off("click");
	$(".blackBtn, .borderBtn, .blueBtn").mouseover(function (e) {
		if (ROOT.device == "m") { return; }
		gsap.to($(this).find(".over"), 0.3, { width: "100%", ease: Power1.easeOut });
	});
	$(".blackBtn, .borderBtn, .blueBtn").mouseout(function (e) {
		if (ROOT.device == "m") { return; }
		gsap.to($(this).find(".over"), 0.3, { width: "0%", ease: Power1.easeOut });
	}); */

	//======================================================

	$(".menuBtn").off("mouseover").off("mouseout").off("click");
	$(".menuBtn").mouseover(function (e) {
		if ($(this).find(".out").length > 0) {
			if ($(this).find(".out").length > 0) {
				gsap.to($(this).find(".out"), 0.7, { css: { "transform": "rotateX(90deg) translateZ(10px)", opacity: 0 }, ease: Power3.easeOut });
				gsap.to($(this).find(".over"), 0.7, { css: { "transform": "rotateX(0deg) translateZ(10px)", opacity: 1 }, ease: Power3.easeOut });
			}
		}
		gsap.to($(this).find("span"), 0.7, { width: "100%", ease: Power3.easeOut });
	});
	$(".menuBtn").mouseout(function (e) {
		if ($(this).find(".out").length > 0) {
			if ($(this).find(".out").length > 0) {
				gsap.to($(this).find(".out"), 0.7, { css: { "transform": "rotateX(0deg) translateZ(10px)", opacity: 1 }, ease: Power3.easeOut });
				gsap.to($(this).find(".over"), 0.7, { css: { "transform": "rotateX(-90deg) translateZ(10px)", opacity: 0 }, ease: Power3.easeOut });
			}
		}
		gsap.to($(this).find("span"), 0.7, { width: "0%", ease: Power3.easeOut });
	});

	$(".menuBtn").click(function (e) {
		var val = $(this).attr("value");
		ROOT.send2GA("button", "menuBtn_" + val);
		//window.location.hash = val;
		//alert(val);
		if (val == "booking" || val == "showcenter" || val == "spec" || val == "pdf" || val == "expore") { return; }
		if (val == "home") {
			gsap.to($("html,body"), 1, { scrollTop: 0, ease: Power2.easeOut });
			return;
		}

		if (window.location.pathname.indexOf("city.html") == -1) {
			var ans = $("#" + val + "Area").offset().top - $("nav").height();
			//console.log(ans, $("nav").height());
			//$("html,body").animate({ scrollTop: ans }, 800);
			gsap.to($("html,body"), 1, { scrollTop: ans, ease: Power2.easeOut });
			ROOT.hideMenu();
			//console.log(".menuBtn:"+val);
		} else {
			window.open("index.html#" + val, "_self");
		}

	});


	$(".bookingBtn").off("click");
	$(".bookingBtn").click(function (e) {
		//var ans = $("#bookingArea").position().top - $("nav").height();
		//$("html,body").animate({ scrollTop: ans }, 800);
		//gsap.to($("html,body"), 1, { scrollTop: ans, ease: Power2.easeOut });

		ROOT.hideMenu();
		ROOT.send2GA("button", "bookingBtn");

		//MINI追蹤碼-TaiwanTravel_20220126
		//fbq('track', 'Lead');
		fbq('trackSingleCustom', '353940183091410', 'Lead');

		gtag('event', 'conversion', { 'send_to': 'AW-311735803/tUGuCLeFh5QDEPvr0pQB' });

		_lt('send', 'cv', {
			type: 'BookTaiwanTravel'
		}, ['04349a9d-2cb8-4155-92d7-9511847cfd2c']);


	});

	$(".showcenterBtn").off("click");
	$(".showcenterBtn").click(function (e) {
		window.open("https://www.mini.com.tw/zh_TW/home/NewPage/show_center.html", "_blank");
		ROOT.send2GA("button", "showcenterBtn");
	});

	$(".exploreBtn").off("click");
	$(".exploreBtn").click(function (e) {
		window.open("https://www.mini.com.tw/zh_TW/home.html", "_blank");
		ROOT.send2GA("button", "exploreBtn");
	});

	/* $(".pdfBtn").off("click");
	$(".pdfBtn").click(function (e) {
		window.open("https://www.mini.com.tw/zh_TW/home/NewPage/catalog-download.html", "_blank");
		ROOT.send2GA("button", "pdfBtn");
	}); */

	$(".fbBtn").off("click");
	$(".fbBtn").click(function (e) {
		//window.open("https://www.facebook.com/sharer/sharer.php?display=popup&u="+shareURL, 'fbShareWindow', 'width=700,height=600, top=' + ($(window).height() / 2 - 350) + ', left=' + ($(window).width() / 2 - 300) + ', toolbar=0, location=0, menubar=0, directories=0, scrollbars=0');
		window.open("https://www.facebook.com/TW.MINI", '_blank');
		ROOT.send2GA("button", "fbBtn");
	});

	$(".igBtn").off("click");
	$(".igBtn").click(function (e) {
		window.open("https://www.instagram.com/mini.taiwan/", '_blank');
		ROOT.send2GA("button", "igBtn");
	});

	$(".lineBtn").off("click");
	$(".lineBtn").click(function (e) {
		//console.log("lineBtn");
		//window.open("https://social-plugins.line.me/lineit/share?url="+shareLineURL);
		window.open("https://lin.ee/oJWTcaP", '_blank');
		ROOT.send2GA("button", "lineBtn");
	});



	//ROOT.checkView();
	ROOT.hideMenu();
	if (typeof THIS == "function") { THIS.setup() };

}

ROOT.toggleMenu = function () {
	if ($("menu").hasClass("active")) {
		$("menu").removeClass("active");
		ROOT.hideMenu();
	} else {
		$("menu").addClass("active");
		ROOT.showMenu();
	}
}
ROOT.toggleToX = function () {
	//console.log("toggleToX:");
	gsap.to($(".toggleBtn span").eq(0), 0.5, { css: { transform: "translateY(0%) rotate(45deg)" }, ease: Power2.easeOut });//y:btnx*size,
	gsap.to($(".toggleBtn span").eq(1), 0.5, { alpha: 0, ease: Power2.easeOut });
	gsap.to($(".toggleBtn span").eq(2), 0.5, { css: { transform: "translateY(0%) rotate(-45deg)" }, ease: Power2.easeOut });//y:-btnx*size,
}
ROOT.toggleToL = function () {
	//console.log("toggleToL:");
	var btnw = $(".toggleBtn span").width();
	gsap.to($(".toggleBtn span").eq(0), 0.5, { css: { transform: "translateY(" + (-btnw / 3) + "px) rotate(0deg)" }, ease: Power2.easeOut });//y:0,
	gsap.to($(".toggleBtn span").eq(1), 0.5, { alpha: 1, ease: Power2.easeOut });
	gsap.to($(".toggleBtn span").eq(2), 0.5, { css: { transform: "translateY(" + (btnw / 3) + "px) rotate(0deg)" }, ease: Power2.easeOut });//y:0,
}

ROOT.showMenu = function () {
	$("menu").addClass("active");
	ROOT.toggleToX();
	var mw = $("menu").width();
	//var btnx = $(".toggleBtn span").eq(1).position().top-$(".toggleBtn span").eq(0).position().top;//$(".toggleBtn span").eq(1).position().top;
	gsap.to($("menu"), 0.7, { x: -mw, ease: Power2.easeOut });
	//setupToggleColor("black");
	if (!$("nav").hasClass("active")) {
		ROOT.showNavi();
	}
}
ROOT.hideMenu = function () {
	$("menu").removeClass("active");
	ROOT.toggleToL();
	//console.log("mw:"+mw);
	gsap.to($("menu"), 0.7, { x: 0, ease: Power2.easeOut });

}
ROOT.toggleNavi = function () {
	//console.log($("#navi").hasClass("active"));//$("#navi")[0]._gsTransform.y
	if ($("nav").hasClass("active")) {
		ROOT.hideNavi();
	} else {
		ROOT.showNavi();
	}
}
ROOT.showNavi = function () {
	//toggleToX();
	$("nav").addClass("active");
	gsap.to($("nav"), 0.7, { y: 0, ease: Power2.easeOut });
	//setupToggleColor("black");
}
ROOT.hideNavi = function () {
	//toggleToL();
	$("nav").removeClass("active");
	gsap.to($("nav"), 0.7, { y: -100, ease: Power2.easeOut });
	//setupToggleColor(current);
}

ROOT.checkView = function () {
	//console.log("checkView:");
	$.each(THIS.pageObj, function (key, value) {
		//console.log(key + ":" + value);
		if (!value && $("#" + key + "Area").is(":onScreen")) {
			//console.log(" / checkView " + key + ":" + $("#" + key + "Area").is(":onScreen"));
			//send2GA("page",key);
			THIS.pageObj[key] = true;
			ROOT.playAni(key, "enter");
			if (!ROOT.device == "m") {
				//console.log("checkView:"+ key );
			}
		}
		if (value && !$("#" + key + "Area").is(":onScreen")) {
			//console.log( key + ":false");
			THIS.pageObj[key] = false;
			ROOT.playAni(key, "reset");
			if (!ROOT.device == "m") {

			}
		}
	});
}

ROOT.playAni = function (sname, way) {

	if (THIS.aniList[sname] == undefined) {
		return;
	}
	//console.log("playAni:" + sname, way);
	THIS.playAni(sname, way);
	var area = $("#" + sname + "Area");
	if (sname == "home") {
		if (way == "reset") {
			gsap.to($("#homeArea .bg"), 0, { "scale": 1, alpha: 0 });
			gsap.to($("#homeArea h1 p.en ,#homeArea h1 p.ch"), 0, { "scale": 2, alpha: 0 });
		} else if (way == "enter") {
			gsap.to($("#homeArea .bg"), 3, { "scale": 1.1, alpha: 1, ease: Power2.easeInOut });
			gsap.to($("#homeArea h1 p.en"), 1.5, { "scale": 1, alpha: 1, delay: 0.4, ease: Power2.easeOut });
			gsap.to($("#homeArea h1 p.ch"), 1.5, { "scale": 1, alpha: 1, delay: 1, ease: Power2.easeOut });
		} else if (way == "exit") {

		} else if (way == "show") {
			gsap.to($("#homeArea .bg"), 0, { "scale": 1, alpha: 1 });
			gsap.to($("#homeArea h1 p.en ,#homeArea h1 p.ch"), 0, { "scale": 1, alpha: 1 });
		}
	}

	$.each(THIS.aniList[sname], function (i, obj) {
		var mc = area.find(obj);
		//console.log(mc)
		if (mc.length > 0) {
			gsap.killTweensOf(mc);
			if (way == "reset") {
				gsap.to(mc, 0, { "y": "3em", alpha: 0 });
			} else if (way == "enter") {
				gsap.to(mc, 1.2, { "y": "0px", alpha: 1, delay: i * 0.4, ease: Power2.easeOut });
			} else if (way == "exit") {
			} else if (way == "show") {
				gsap.to(mc, 0, { "y": "0px", alpha: 1 });
			}
		}

	});
}




ROOT.send2GA = function (way, code) {
	console.log("send2GA:" + way, code);
	if (gtag != "undefined") {
		if (way == "page") {
			gtag('event', 'page_view', { 'event_category': 'screen_view', 'event_action': 'view', 'event_label': code });
		} else if (way == "button") {
			gtag('event', 'button', { 'event_category': 'button', 'event_action': 'click', 'event_label': code });
		}
	}
}



var fontLOCAL = "//font.arphic.com/FontSubsetOutput/2015060100637/4EE0B1DF40C6A794E997DA44B471FD02/2015060100637.JS?2803921449";
//main-tw
var fontMINI = "//font.arphic.com/FontSubsetOutput/2015060100637/4266038E291875B875F6364C9F9BC1AA/2015060100637.JS?8182055577";
//event.mini.com
var fontEVENT = "//font.arphic.com/FontSubsetOutput/2015060100637/D98C4BE2E88FD70259429738CC93BD2B/2015060100637.JS?2851754688";
var fontLETSPLAY = "//font.arphic.com/FontSubsetOutput/2015060100637/2733017B5E52385903D9DAF80E0E2C33/2015060100637.JS?6296773110";
var font2of3 = "//font.arphic.com/FontSubsetOutput/2015060100637/80BC215C2D17FB5C5D3674BC0066998C/2015060100637.JS?9434255397";

ROOT.addScript = function (src) {
	var s = document.createElement('script');
	s.setAttribute('id', "jsFont");
	s.setAttribute('src', src);
	document.body.appendChild(s);
}

ROOT.fontBackFunc;
ROOT.fontLoad;
ROOT.isFontLoaded = false;

ROOT.setupFont = function () {

	var url = window.location.href;
	if (url.indexOf("main-tw") != -1) {
		ROOT.addScript(fontMINI);
	} else if (url.indexOf("event.mini.com") != -1) {
		ROOT.addScript(fontEVENT);
	} else if (url.indexOf("letsplay") != -1) {
		ROOT.addScript(fontLETSPLAY);
	} else if (url.indexOf("localhost") != -1) {
		ROOT.addScript(fontLOCAL);
	} else if (url.indexOf("2of3") != -1) {
		ROOT.addScript(font2of3);
	}
	ROOT.fontLoad = setInterval(ROOT.checkFont, 1000);
	//$("#loading .loadTxt").hide();
	//$("#loading .fontTxt").show();
}
ROOT.checkFont = function () {
	console.log("checkFont:" + $("html").hasClass("arwf-active"));
	if ($("html").hasClass("arwf-inactive") || $("html").hasClass("arwf-active")) {
		clearInterval(ROOT.fontLoad);
		ROOT.fontComplete();
		eval("ROOT.fontBackFunc()");
	} else {

	}
}
ROOT.fontComplete = function () {
	ROOT.isFontLoaded = true;
	//console.log("fontComplete:");
	//THIS.playAni("home", "enter");

}

$.parameter = function (name) {
	var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
	if (results == null) {
		return null;
	} else {
		return decodeURI(results[1]) || 0;
	}
}